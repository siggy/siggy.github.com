<html>
<head>
<script type="text/javascript">
<!--
/**
 * Lists the entries from the specified JSON feed
 * by creating a new 'dl' element in the DOM.
 * Each 'dt' is the title of the row, and each 'dd'
 * is the content of the row.
 */
function listEntries(json) {

  removeOldResults();

  var dl = document.createElement('dl');
  dl.setAttribute('id', 'output');

  for (var i = 0; i < json.feed.entry.length; i++) {

    var entry = json.feed.entry[i];

    var dt = document.createElement('dt');
    var title = document.createTextNode(entry.title.$t);
    dt.appendChild(title);

    var dd = document.createElement('dd');
    var content = document.createTextNode(entry.content.$t);
    dd.appendChild(content);

    dl.appendChild(dt);
    dl.appendChild(dd);
  }

  document.getElementById('data').appendChild(dl);

  // Re-enable the ok button.
  var ok_button = document.getElementById('ok_button');
  ok_button.removeAttribute('disabled');
}

/**
 * Lists the entries from the specified JSON feed
 * by inserting the cells into a new 'table'
 * element in the DOM.  Each 'tr' represents a
 * row in the spreadsheet, and each 'td' is a cell
 * within that row.
 */
function cellEntries(json) {

  removeOldResults();

  var table = document.createElement('table');
  table.setAttribute('id', 'output');
  var tbody = document.createElement('tbody');

  var tr;

  for (var i=0; i < json.feed.entry.length; i++) {

    var entry = json.feed.entry[i];
    if (entry.gs$cell.col == '1') {
      if (tr != null) {
        tbody.appendChild(tr);
      }

      tr = document.createElement('tr');
    }

    var td = document.createElement('td');
    td.appendChild(document.createTextNode(entry.content.$t));
    tr.appendChild(td);
  }

  tbody.appendChild(tr);
  table.appendChild(tbody);
  document.getElementById('data').appendChild(table);

  // Re-enable the ok button.
  var ok_button = document.getElementById('ok_button');
  ok_button.removeAttribute('disabled');
}

/**
 * Called when the user clicks the 'OK' button to
 * retrieve a spreadsheet's JSON feed.  Creates a new
 * script element in the DOM whose source is the JSON feed,
 * and specifies that the callback function is
 * 'listEntries' for a list feed and 'cellEntries' for a
 * cells feed (above).
 */
function displayResults(query) {
  removeOldJSONScriptNodes();
  removeOldResults();

  // Show a "Loading..." indicator.
  var div = document.getElementById('data');
  var p = document.createElement('p');
  p.appendChild(document.createTextNode('Loading...'));
  div.appendChild(p);

  // Disable the OK button
  var ok_button = document.getElementById('ok_button');
  ok_button.disabled = 'true';

  // Retrieve the JSON feed.
  var script = document.createElement('script');

  if (query.feed.options[query.feed.selectedIndex].text == 'list') {
    script.setAttribute('src', 'http://spreadsheets.google.com/feeds/'
                         + query.feed.options[query.feed.selectedIndex].text
                         + '/' + query.key.value
                         + '/' + query.worksheet.value + '/public/values' +
                        '?alt=json-in-script&callback=listEntries');
  }

  if (query.feed.options[query.feed.selectedIndex].text == 'cells') {
    script.setAttribute('src', 'http://spreadsheets.google.com/feeds/'
                         + query.feed.options[query.feed.selectedIndex].text
                         + '/' + query.key.value
                         + '/' + query.worksheet.value + '/public/values' +
                        '?alt=json-in-script&callback=cellEntries');
  }

  script.setAttribute('id', 'jsonScript');
  script.setAttribute('type', 'text/javascript');
  document.documentElement.firstChild.appendChild(script);;
}

/**
 * Removes the script element from the previous result.
 */
function removeOldJSONScriptNodes() {
  var jsonScript = document.getElementById('jsonScript');
  if (jsonScript) {
    jsonScript.parentNode.removeChild(jsonScript);
  }
}

/**
 * Removes the output generated from the previous result.
 */
function removeOldResults() {
  var div = document.getElementById('data');
  if (div.firstChild) {
    div.removeChild(div.firstChild);
  }
}
//-->
</script>
<link rel="stylesheet" type="text/css" href="http://code.google.com/css/dev_docs.css">
</head>
<body>
<h2>Simple example of retrieving JSON feeds from Spreadsheets Data API</h3>
<p><h3>Introduction</h3></p>
<p>This sample demonstrates displaying a list or cells feed for a particular
worksheet in a spreadsheet using the JSON output format provided by the
Spreadsheet Data API.  This allows you to query a spreadsheet's public list or
cell feed and get the resulting entries returned as JSON objects.  To use the new JSON feed, create a script element whose <code>src</code> value is</p>
<p><blockquote><code>http://spreadsheets.google.com/feeds/<b>feed</b>/<b>key</b>/<b>worksheet</b>/public/basic?alt=json-in-script&callback=<b>myFunc</b></code></blockquote></p>

<p>where <b><code>feed</code></b> is the type of feed, <b><code>key</code></b>
is the key of the spreadsheet you want to retrieve, the
<b><code>worksheet</code></b> is the positional or unique identifier of the worksheet, and <b><code>myFunc</code></b> is the name of your callback function that is passed the JSON object. For more information on JSON output support for Google data APIs please see our <a href="http://code.google.com/apis/gdata/json.html">JSON output support documentation</a>.</p>

<p><b>Note:</b> Retrieving a feed without authentication is only supported for
published spreadsheets.</p>
<p><b>Note:</b> Other feed types and visibility and projection values may be
used with JSON output support.  For more information on other feed types, and
visibility and projection values please see the  <a
href="http://code.google.com/apis/gdata/spreadsheets.html">Spreadsheet Data
API</a> documentation.</p>

<p><h3>Demo</h3></p>

<form onsubmit="return false">
<p>Spreadsheet: http://spreadsheets.google.com/feeds/

<select name="feed">
  <option>list</option>
  <option>cells</option>
</select>/
<input type="text" name="key" size="44" maxlength="43"
value="o13394135408524254648.240766968415752635">/
<input type="text" name="worksheet" size="4" value="od6">/public/values&nbsp;
<button id='ok_button'
onclick="displayResults(this.form);">OK</button>
</p></form>

<div id="data"></div>

</body></html>



